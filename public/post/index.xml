<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Blog • Ken M. Haggerty</title>
    <link>http://kenmhaggerty.com/blog/post/</link>
    <description>Recent content in Posts on Blog • Ken M. Haggerty</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 04 Jul 2016 17:58:44 -0400</lastBuildDate>
    <atom:link href="http://kenmhaggerty.com/blog/post/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>A Better Way To Animate Table View Updates</title>
      <link>http://kenmhaggerty.com/blog/post/animating-tableview-updates/</link>
      <pubDate>Mon, 04 Jul 2016 17:58:44 -0400</pubDate>
      
      <guid>http://kenmhaggerty.com/blog/post/animating-tableview-updates/</guid>
      <description>&lt;p&gt;Whenever I find myself re-using a helper method in many of my classes or projects, I like to add it to a shared class I created called &lt;a href=&#34;https://github.com/kenmhaggerty/KMHGenerics&#34;&gt;&lt;strong&gt;KMHGenerics&lt;/strong&gt;&lt;/a&gt;. This class contains generically useful methods so that my actual code can remain as &lt;a href=&#34;https://en.wikipedia.org/wiki/Don%27t_repeat_yourself&#34;&gt;&amp;ldquo;dry&amp;rdquo;&lt;/a&gt; as possible.&lt;/p&gt;

&lt;p&gt;Today I&amp;rsquo;m going to talk about a method I wrote to animate complex updates to UITableViews. The KMHGenerics class shared &lt;a href=&#34;https://github.com/kenmhaggerty/KMHGenerics&#34;&gt;here on GitHub&lt;/a&gt; includes many other methods too, but I&amp;rsquo;ll save those for another blog post.&lt;/p&gt;

&lt;p&gt;Those of you familiar with UITableView methods are probably comfortable inserting, reordering, and deleting rows from your table view, but what happens if you want to perform a mix of these actions within a single animation? For example, how would you animate inserting a row at the end of your table view while simultaneously deleting the first row of your table view and reordering the remaing cells?&lt;/p&gt;

&lt;p&gt;If you are efficient and looking for the simplest solution, the answer is to call &lt;code&gt;[self.tableview reloadData]&lt;/code&gt; and update the entire table view at once. While this works, the lack of animations can be, in certain situations, extremely confusing to the user&amp;mdash;much like the following GIF:&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;http://kenmhaggerty.com/blog/blog/images/animating-tableview-updates/change-blindness.gif&#34;&gt;
&lt;/div&gt;
&lt;span class=&#34;caption&#34;&gt;&lt;strong&gt;Above&lt;/strong&gt; An example of &lt;a href=&#34;https://en.wikipedia.org/wiki/Change_blindness&#34;&gt;change blindness&lt;/a&gt;. Can you spot the difference between the two images? A blank frame added between the two images breaks the visual continuity, making it much harder to spot changes. Similarly, when updates to UITableView are not animated, it can be very difficult to spot what changed. &lt;a href=&#34;https://www.csc.ncsu.edu/faculty/healey/PP/&#34;&gt;[Source]&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Instead, I&amp;rsquo;ve written the following method on UITableView to perform updates in a single animation:&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/kenmhaggerty/9c0124d7684413fec140263a3c435aa9.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;This method takes in the follow ten parameters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;array&lt;/strong&gt;: The current state of the data supplying the table view.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;toArray&lt;/strong&gt;: The desired final state of your table view&amp;rsquo;s data.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;section&lt;/strong&gt;: Which section of your table view to animate.&lt;sup id=&#34;ref_1&#34;&gt;&lt;a href=&#34;#footnote_1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;insertionAnimation&lt;/strong&gt;: What animation style to use when inserting new cells in your table view.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;deletionAnimation&lt;/strong&gt;: What animation style to use when deleting cells from your table view.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;setter&lt;/strong&gt;: A block that sets the data for your table view.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;insertedCells&lt;/strong&gt;: An optional block to execute on the cells that will be inserted.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;reorderedCells&lt;/strong&gt;: An optional block to execute on the cells that will be reodered.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;deletedCells&lt;/strong&gt;: An optional block to execute on the cells that will be deleted.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;completion&lt;/strong&gt;: An optional block to execute upon completion of all animations.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To help illustrate, I&amp;rsquo;ve embedded an interactive demo below showing. Try it out and let me know what you think!&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;figure&#34;&gt;
&lt;iframe class=&#34;figureContent&#34; src=&#34;https://appetize.io/embed/qkm9627b77pvrr7rqf831ty84r?device=iphone4s&amp;scale=100&amp;autoplay=true&amp;orientation=portrait&amp;screenOnly=true&#34; width=&#34;320px&#34; height=&#34;480px&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;span class=&#34;caption&#34;&gt;&lt;strong&gt;Above&lt;/strong&gt; Tap &amp;ldquo;Shuffle&amp;rdquo; to generate random data for the table view. By toggling the switch at top-left, you can see the difference between animated and instantaneous table view updates for yourself. &lt;a href=&#34;https://appetize.io&#34;&gt;[Created using Appetize.io]&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p class=&#34;footnotes&#34;&gt;
&lt;a name=&#34;footnote_1&#34; href=&#34;#ref_1&#34;&gt;1&lt;/a&gt; Currently this method only supports updating one table view section at a time. At some point I should implement a version that supports updating multiple table view sections simultaneously, e.g., for when table view cells are moved between sections.
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>App Architecture (or, Making Sure The Chef Isn&#39;t Performing Heart Surgery)</title>
      <link>http://kenmhaggerty.com/blog/post/app-architecture/</link>
      <pubDate>Fri, 01 Jul 2016 11:10:04 -0400</pubDate>
      
      <guid>http://kenmhaggerty.com/blog/post/app-architecture/</guid>
      <description>&lt;p&gt;When I think about classes in Objective-C I imagine running a restaurant. A well run restaurant not only prepares good food but also provides excellent service and manages employees well. A good restaurant also delegates out whatever it cannot or should not do itself. For example: if a guest at your restaurant were in need of medical attention, you would probably call an ambulance and not ask your chef to attempt heart surgery (no matter how good he or she may be with knives).&lt;/p&gt;

&lt;p&gt;A well-built app follows similar principles. Your core functionalities should be grouped and split between classes so that each class has one area of expertise. Classes should communicate and depend on each other in a clear and coordinated fashion and not haphazardly. Classes should be independent of each other and self-contained. And certain things that are too complicated for you to do yourself or that are not core to the app (e.g., your backend) should be outsourced to third party libraries, frameworks, services, and APIs.&lt;/p&gt;

&lt;p&gt;When it came to building an app that both persists data locally and synchronizes data with a remote server (in this case, &lt;a href=&#34;https://www.firebase.com/&#34;&gt;Firebase&lt;/a&gt;), I spent some time making sure that what I built not only &lt;em&gt;worked&lt;/em&gt; but also &lt;em&gt;made sense&lt;/em&gt;. This involved a lot of trial and error, building and rebuilding, and, of course, refactoring. Ultimately, though, I&amp;rsquo;ve come around to the following architecture which, to me, seems pretty universal:&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;https://docs.google.com/drawings/d/1YN09kkYLQymJxVmq-IKgZCWBX5KSdaOVN6uZKN-g5xk/pub?w=487&amp;amp;h=383&#34;&gt;
&lt;/div&gt;
&lt;span class=&#34;caption&#34;&gt;&lt;strong&gt;Above&lt;/strong&gt; Abstracting apart classes for managing local data storage (Core Data Controller), remote data storage (Firebase Controller), and synchronization (Sync Engine) allows for a cleaner interface with our app (Data API) and greater flexibility should we need to change backend providers.&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In the above diagram, all requests for data are routed through the &lt;strong&gt;Data Manager&lt;/strong&gt;. This includes everything from fetching data to deleting data to synchronizing data. Requests involving local data are then routed to our &lt;strong&gt;Core Data Controller&lt;/strong&gt;, while requests involving our remote database are routed to our &lt;strong&gt;Sync Engine&lt;/strong&gt;. Our Core Data Controller then interacts with our data objects directly (in this case, our &lt;strong&gt;Managed Objects&lt;/strong&gt;), while our Sync Engine directs remote database requests to Firebase via our intermediary &lt;strong&gt;Firebase Controller&lt;/strong&gt; class.&lt;/p&gt;

&lt;p&gt;The arrows in the diagram indicate the logical flow between classes. They also represent dependencies between classes. To avoid circular dependencies, there should be no double-headed arrows; the only exception here is between our Sync Engine and our backend (i.e., Firebase Controller).&lt;sup id=&#34;ref_1&#34;&gt;&lt;a href=&#34;#footnote_1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;Some of the arrows between our classes have dotted lines. That&amp;rsquo;s just to show that the connection between these classes are weaker. The dotted line from our Data Manager to our Sync Engine simply indicates that these two classes are connected only so that our Data Manager can manually trigger a sync if necessary (e.g., when the user taps a reload button). Meanwhile, the dotted lines between our Managed Objects and our Sync Engine represent NSNotifications sent out by our Managed Objects when certain key values change; our Sync Engine listens for these notifications and, in response, pushes these changes to our remote server via our Firebase Controller.&lt;/p&gt;

&lt;p&gt;Our diagram above is also organized so that our most app-facing classes are at the top and our most back-end facing classes are towards the bottom.&lt;/p&gt;

&lt;p&gt;This diagram also includes a &lt;strong&gt;Notifications Controller&lt;/strong&gt; for scheduling and managing local notifications. When our app receives a local notification, our &lt;strong&gt;App Delegate&lt;/strong&gt; handles the response. While local notifications aren&amp;rsquo;t part of our synchonization scheme, you can see how its architecture resembles that of our Firebase Controller. This allows our app to be easily extended without extensive refactoring.&lt;/p&gt;

&lt;p&gt;If organizing the &amp;ldquo;model&amp;rdquo; component of our &lt;a href=&#34;https://developer.apple.com/library/ios/documentation/General/Conceptual/DevPedia-CocoaCore/MVC.html&#34;&gt;MVC architecture&lt;/a&gt; in this way makes sense, then we can begin to investigate how actually to implement it in an app. In my next few blog posts, I&amp;rsquo;ll delve deeper into how I did this in my newest app &lt;a href=&#34;https://www.appstore.com/pushquery&#34;&gt;PushQuery&lt;/a&gt;, including &lt;a&gt;tips and tricks to working with Core Data&lt;/a&gt;; &lt;a&gt;using protocols to abstract implementation from interface&lt;/a&gt;; &lt;a&gt;realtime synchronization via Firebase&lt;/a&gt;; and &lt;a&gt;how to schedule and update local notifications&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Questions? Feedback? Let me know!&lt;br /&gt;
&lt;a href=&#34;mailto:kenmhaggerty@gmail.com?Subject=Re:%20[Blog]%20App%20Architecture&#34;&gt;kenmhaggerty@gmail.com&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p class=&#34;footnotes&#34;&gt;
&lt;a name=&#34;footnote_1&#34; href=&#34;#ref_1&#34;&gt;1&lt;/a&gt; Our Sync Engine is a delegate of our Firebase Controller that updates our local data store when our Firebase Controller receives updates from our remote server. This architecture is specific but not unique to the way Firebase works.
&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>